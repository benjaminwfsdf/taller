<!DOCTYPE html>
<html lang="es">
<head>
  <base target="_self">

  <link rel="manifest" href="/manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Taller">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <meta name="theme-color" content="#000000">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="icon" type="image/png" href="img/scanner.png">
  <title>Buscar Veh√≠culo | Walter Uriol</title>

  <style>
    :root{
      --brand:#d40000;
      --brand-dark:#9b0000;
      --blue:#1d3053;
      --blue-dark:#1d3053;
      --ink:#ffffff;
      --radius:18px;
      --shadow:0 12px 30px rgba(0,0,0,.45);
      --shadow-soft:0 10px 26px rgba(0,0,0,.25);
    }

    *{ box-sizing:border-box; }

    /* ===============================
       üî• FONDO FIJO VERSION A
       =============================== */
    body{
      margin:0;
      min-height:100dvh;
      overflow-x:hidden;
      font-family:system-ui,Segoe UI,Roboto,Arial;

      background:url("img/portada_celular.png") no-repeat center/cover fixed;
      background-color:#000;
    }

    @media(min-width:768px){
      body{
        background:url("img/portada_pc.png") no-repeat center/cover fixed;
      }
    }

    body::before{
      content:"";
      position:fixed;
      inset:0;
      background-image:inherit;
      background-size:cover;
      background-position:center;
      background-repeat:no-repeat;
      z-index:-1;
      pointer-events:none;
    }

    /* TOPBAR */
    .topbar{
      background:#1d3053;
      color:white;
      text-align:center;
      padding:14px;
      font-weight:700;
      letter-spacing:.8px;
      border-bottom:5px solid var(--brand);
      box-shadow:var(--shadow-soft);
      position:sticky;
      top:0;
      z-index:10;
    }

    .wrapper{
      max-width:1100px;
      margin:38px auto 60px;
      padding:0 22px;
      width:100%;
    }

    .frame{
      background:rgba(135,206,250,0.35);
      border-radius:var(--radius);
      padding:22px;
      box-shadow:var(--shadow);
      border:3px solid var(--brand);
      backdrop-filter:blur(8px);
      margin:0 auto;
    }

    .header{
      background:#1d3053;
      color:white;
      border-radius:16px;
      padding:20px;
      text-align:center;
      font-weight:900;
      border:3px solid var(--brand);
      margin-bottom:22px;
    }

    .header h1{
      margin:0;
      font-size:clamp(1.6rem,5vw,2.3rem);
    }

    .card{
      background:#1d3053;
      border:3px solid var(--brand);
      border-radius:16px;
      padding:22px;
      margin-bottom:22px;
      box-shadow:var(--shadow);
    }

    label{
      display:block;
      margin:8px 0 6px;
      font-weight:800;
      color:white;
      font-size:clamp(1rem,3vw,1.1rem);
    }

    input{
      width:100%;
      padding:12px 14px;
      border:2px solid rgba(255,255,255,0.2);
      border-radius:12px;
      background:rgba(0,0,0,0.3);
      color:white !important;
      font-size:clamp(1rem,3vw,1.1rem);
      text-transform:uppercase;
    }

    .btn{
      background:white;
      color:black;
      padding:12px 24px;
      font-weight:900;
      border-radius:14px;
      border:3px solid var(--brand);
      transition:.25s;
      width:100%;
      margin-top:18px;
      text-align:center;
      cursor:pointer;
      box-shadow:0 4px 10px rgba(0,0,0,.35);
    }

    .result-block{
      margin-top:20px;
      background:rgba(0,0,0,0.35);
      border:2px solid var(--brand);
      border-radius:12px;
      padding:18px;
      color:white;
      font-size:clamp(0.9rem,3vw,1rem);
      box-shadow:0 4px 12px rgba(0,0,0,.4);
    }

    .ultimo{
      border:3px solid #00ff8c !important;
      box-shadow:0 0 14px #00ff8c !important;
    }

    .item{ margin-bottom:6px; }
    .item strong{
      color:#a8f0a9;
      display:inline-block;
      min-width:140px;
    }

    .btn-secondary{
      background:transparent;
      color:white !important;
      border:3px solid white !important;
      padding:12px 24px;
      border-radius:14px;
      font-weight:900;
      display:inline-block;
      margin-top:20px;
      text-align:center;
      text-decoration:none;
      box-shadow:0 4px 10px rgba(0,0,0,.35);
    }

    .footer{
      text-align:center;
      color:white;
      font-size:13px;
      margin-top:22px;
      text-shadow:0 2px 6px black;
    }
  </style>
</head>

<body>

  <div class="topbar">WWW.MECANICAWALTERURIOL.CL</div>

  <div class="wrapper">
    <div class="frame">
      <div class="header"><h1>Buscar Veh√≠culo</h1></div>

      <div class="card">
        <label>Buscar por patente, nombre o tel√©fono:</label>
        <input type="text" id="valor" placeholder="EJ: ABCD12">

        <button class="btn" onclick="buscar()">üîç Buscar</button>

        <div id="historial"></div>

        <a href="gestion_autos.html" class="btn-secondary">‚Üê Volver al Men√∫ Principal</a>
      </div>

      <div class="footer">¬© 2025 Benjam√≠n Gonz√°lez ‚Äî Todos los derechos reservados.</div>
    </div>
  </div>

<script>

const API_URL =
 "https://script.google.com/macros/s/AKfycbykLqYHshN0H9byTFBOa-fQmeWeGgkIOol7_GbUr9no7QJ6l0PQbeslQPKCkFFEKIa4MQ/exec";

const norm = t => String(t||"").normalize("NFD").replace(/\p{Diacritic}/gu,"").toUpperCase().trim();
const digits = t => String(t||"").replace(/\D/g,"");

function formatearFecha(f){
  if(!f) return "-";
  const d = new Date(f);
  return `${String(d.getDate()).padStart(2,"0")}/${String(d.getMonth()+1).padStart(2,"0")}/${d.getFullYear()}`;
}

function formatearKM(val){
  if(!val) return "-";
  return String(val).replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

async function buscar(){
  const val = valor.value.trim();
  if(!val){
    alert("Ingresa un dato para buscar");
    return;
  }

  const rows = await fetch(API_URL).then(r=>r.json());

  const coincidencias = rows.filter(r=>{
    const patente = norm(r["Patente"]);
    const nombre  = norm(r["Nombre"]);
    const fono    = digits(r["Tel√©fono"] || r["Telefono"]);

    return patente.includes(norm(val)) ||
           nombre.includes(norm(val)) ||
           fono.endsWith(digits(val));
  });

  const cont = document.getElementById("historial");
  cont.innerHTML = "";

  if(!coincidencias.length){
    cont.innerHTML = `<div class="result-block">No se encontraron registros.</div>`;
    return;
  }

  const patenteBase = norm(coincidencias[0]["Patente"]);
  const historial = rows.filter(r => norm(r["Patente"]) === patenteBase);

  historial.sort((a,b)=> new Date(b["Fecha"]) - new Date(a["Fecha"]));

  cont.innerHTML = `
    <h3 style="color:white;text-shadow:0 3px 8px black;margin-bottom:12px;">
      Historial completo de ${patenteBase}
    </h3>`;

  historial.forEach((r,i)=>{
    const box = document.createElement("div");
    box.className = "result-block " + (i==0 ? "ultimo" : "");

    box.innerHTML = `
      <div class="item"><strong>Fecha:</strong> ${formatearFecha(r["Fecha"])}</div>
      <div class="item"><strong>Orden de Trabajo:</strong> ${r["OrdenTrabajo"] || "-"}</div>
      <div class="item"><strong>Nombre:</strong> ${r["Nombre"]}</div>
      <div class="item"><strong>Tel√©fono:</strong> ${r["Tel√©fono"] || r["Telefono"]}</div>
      <div class="item"><strong>Direcci√≥n:</strong> ${r["Direcci√≥n"]}</div>
      <div class="item"><strong>Marca:</strong> ${r["Marca"]}</div>
      <div class="item"><strong>Modelo:</strong> ${r["Modelo"]}</div>
      <div class="item"><strong>Patente:</strong> ${r["Patente"]}</div>
      <div class="item"><strong>Kilometraje:</strong> ${formatearKM(r["Kilometraje"])}</div>
      <div class="item"><strong>Estado:</strong> ${r["Estado"]}</div>
      <div class="item"><strong>Detalle:</strong> ${r["Detalle Estado"] || r["Detalle"]}</div>
    `;

    cont.appendChild(box);
  });
}

</script>

</body>
</html>
